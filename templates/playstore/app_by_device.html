{% extends 'layout/base.html' %}

{% block content %}
<div class="container-fluid py-2">
    <h2 class="mb-3">Top Apps</h2>
    <div class="row">
        <div class="col-12 app-scroll-container">
            {% for app in apps %}
            <a href="{% url 'detail' type='app' id=app.id %}">
                <div class="app-card">
                    <img src="{{ app.image.url }}" alt="{{ app.title }}" class="app-icon img-fluid">
                    <div class="app-title" title="{{ app.title }}">{{ app.title }}</div>
                    <div class="app-rating">
                        <span class="star">â˜…</span>{{ app.rating }}
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}




{% block css %}
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f8f9fa;
        color: #333;
        margin: 0;
        padding: 0;
    }

    h1 {
        color: #333;
        font-weight: 700;
    }

    .e-topic {
        font-family: Bitter, Georgia, Cambria, Times New Roman, Times, serif;
        font-weight: bold;
        position: relative;
        display: inline-block;
    }

    .e-topic::after {
        content: '';
        position: absolute;
        width: 100%;
        height: 2px;
        background-color: #333;
        bottom: -5px;
        left: 0;
        transform: scaleX(0);
        transform-origin: bottom right;
        transition: transform 0.3s ease-in-out;
    }

    .e-topic:hover::after {
        transform: scaleX(1);
        transform-origin: bottom left;
    }

    .app-scroll-container {
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none;  /* Internet Explorer 10+ */
    }

    .app-scroll-container::-webkit-scrollbar { /* WebKit */
        display: none;
    }

    .app-card {
        display: inline-block;
        width: 190px;
        height: auto;
        transition: transform 0.2s, box-shadow 0.2s;
        padding: 10px;
        border-radius: 8px;
    }

    .app-card:hover {
        background-color: #efefef;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .article-image {
        height: 200px;
        object-fit: cover;
    }

    @media (max-width: 768px) {
        .article-image {
            height: 250px;
        }
    }

    .card-title {
        font-weight: 600;
        color: #2c3e50;
    }

    .card-text {
        color: #7f8c8d;
    }

    .btn-dark {
        background-color: #333;
        border-color: #333;
    }

    .btn-dark:hover {
        background-color: #444;
        border-color: #444;
    }

    .star-rating {
        color: #ffc107;
        cursor: pointer;
    }

    .star-rating .fa-star {
        transition: color 0.2s;
    }

    .star-rating .fa-star:hover,
    .star-rating .fa-star.active {
        color: #ffc107;
    }

    .rating-value {
        color: #6c757d;
        font-size: 0.9em;
        margin-left: 5px;
    }

    .app-icon {
        width: 180px;
        height: 170px;
        border-radius: 20%;
        margin-bottom: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .app-title {
        font-size: 15px;
        font-weight: 500;
        color: #333;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .app-rating {
        font-size: 14px;
        color: #595959;
        font-weight: bold;
    }

    .star {
        color: #ffd700;
        margin-right: 3px;
    }

    .app-developer {
        font-size: 12px;
        color: #888;
        margin-top: 3px;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>
{% endblock %}



{% block js %}
<script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const starRatings = document.querySelectorAll('.star-rating');

        starRatings.forEach(starRating => {
            const stars = starRating.querySelectorAll('.fa-star');
            const articleId = starRating.dataset.articleId;
            const ratingValue = starRating.querySelector('.rating-value');

            stars.forEach(star => {
                star.addEventListener('mouseover', function () {
                    const rating = this.dataset.rating;
                    highlightStars(stars, rating);
                });

                star.addEventListener('mouseout', function () {
                    resetStars(stars, ratingValue);
                });

                star.addEventListener('click', function () {
                    const rating = this.dataset.rating;
                    submitRating(articleId, rating, ratingValue, stars);
                });
            });
        });

        function highlightStars(stars, rating) {
            stars.forEach(star => {
                if (star.dataset.rating <= rating) {
                    star.classList.remove('far');
                    star.classList.add('fas', 'active');
                } else {
                    star.classList.remove('fas', 'active');
                    star.classList.add('far');
                }
            });
        }

        function resetStars(stars, ratingValue) {
            const currentRating = parseFloat(ratingValue.textContent.match(/\d+(\.\d+)?/)[0]);
            highlightStars(stars, currentRating);
        }

        function submitRating(articleId, rating, ratingValue, stars) {
            fetch(`/api/rate-article/${articleId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ rating: rating })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    ratingValue.textContent = `(${data.new_rating.toFixed(1)}/5)`;
                    highlightStars(stars, data.new_rating);
                    alert('Rating submitted successfully!');
                } else {
                    alert(data.message || 'Failed to submit rating. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            });
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    });
</script>
{% endblock %}
